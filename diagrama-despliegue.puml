@startuml Diagrama de Despliegue - Escalabilidad Horizontal Azure

title Diagrama de Despliegue - Fibonacci App con Escalabilidad Horizontal en Azure

skinparam componentStyle rectangle
skinparam linetype ortho
skinparam backgroundColor #FEFEFE
skinparam shadowing false

' Estilos personalizados
skinparam node {
    BackgroundColor<<azure>> #0078D4
    BackgroundColor<<vm>> #50C878
    BackgroundColor<<network>> #FFB6C1
    BackgroundColor<<security>> #FFD700
    BorderColor Black
    FontColor White
}

skinparam package {
    BackgroundColor #E8F5E9
    BorderColor #4CAF50
}

skinparam cloud {
    BackgroundColor #E3F2FD
    BorderColor #2196F3
}

actor "Cliente/Usuario" as Cliente
cloud "Internet" as Internet

package "Azure Cloud" {
    
    package "Resource Group: SCALABILITY_LAB" {
        
        node "<<Azure Load Balancer>>\nPublic IP: xxx.xxx.xxx.xxx\nSKU: Standard\nZone-Redundant" as LoadBalancer <<azure>> {
            component "Frontend IP\nConfiguration" as Frontend
            component "Load Balancing\nRules\n(Port 3000)" as LBRules
            component "Health Probe\n(HTTP:3000)" as HealthProbe
        }
        
        package "Virtual Network: vnet-canadacentral\nAddress Space: 10.0.0.0/16" {
            
            package "Subnet: default (10.0.0.0/24)" {
                
                node "<<Network Security Group>>" as NSG <<security>> {
                    component "Inbound Rules:\nSSH (22)\nHTTP (3000)" as InboundRules
                }
                
                package "Backend Pool" {
                    
                    frame "Availability Zone 1" {
                        node "<<VM1>>\nUbuntu Server\nSize: B1ls\nPrivate IP: 10.0.0.4" as VM1 <<vm>> {
                            component "Node.js\nRuntime" as Node1
                            artifact "FibonacciApp.js" as App1
                            database "npm\npackages" as NPM1
                        }
                    }
                    
                    frame "Availability Zone 2" {
                        node "<<VM2>>\nUbuntu Server\nSize: B1ls\nPrivate IP: 10.0.0.5" as VM2 <<vm>> {
                            component "Node.js\nRuntime" as Node2
                            artifact "FibonacciApp.js" as App2
                            database "npm\npackages" as NPM2
                        }
                    }
                    
                    frame "Availability Zone 3" {
                        node "<<VM3>>\nUbuntu Server\nSize: B1ls\nPrivate IP: 10.0.0.6" as VM3 <<vm>> {
                            component "Node.js\nRuntime" as Node3
                            artifact "FibonacciApp.js" as App3
                            database "npm\npackages" as NPM3
                        }
                    }
                }
            }
        }
    }
}

' Relaciones
Cliente -down-> Internet : "HTTP Request"
Internet -down-> Frontend : "http://ip:3000/fibonacci/:n"
Frontend -down-> LBRules : "Distribuir tráfico"
LBRules .right.> HealthProbe : "Verificar estado"

HealthProbe .down.> VM1 : "Health Check"
HealthProbe .down.> VM2 : "Health Check"
HealthProbe .down.> VM3 : "Health Check"

LBRules -down-> VM1 : "Balancear\ncarga"
LBRules -down-> VM2 : "Balancear\ncarga"
LBRules -down-> VM3 : "Balancear\ncarga"

NSG .> VM1 : "Aplicar\nreglas"
NSG .> VM2 : "Aplicar\nreglas"
NSG .> VM3 : "Aplicar\nreglas"

Node1 -down-> App1 : "Ejecutar"
App1 .> NPM1 : "require"

Node2 -down-> App2 : "Ejecutar"
App2 .> NPM2 : "require"

Node3 -down-> App3 : "Ejecutar"
App3 .> NPM3 : "require"

note right of LoadBalancer
  <b>Configuración del Load Balancer:</b>
  • Tipo: Público
  • SKU: Standard
  • Distribución: Round-robin
  • Sesión: None (stateless)
  • Zone-Redundant (alta disponibilidad)
end note

note bottom of VM2
  <b>Backend Pool:</b>
  • 3 VMs distribuidas en 3 zonas diferentes
  • Tolerancia a fallos de zona completa
  • Escalabilidad horizontal
  • Cálculo intensivo de secuencia Fibonacci
  • Distribución automática de carga
end note

note right of NSG
  <b>Seguridad:</b>
  • SSH (22) para
    administración remota
  • Puerto 3000 para
    aplicación web
  • Filtrado de tráfico
    entrante/saliente
end note

legend top left
  <b>Componentes del Sistema:</b>
  |<#0078D4>     | Azure Load Balancer |
  |<#50C878>     | Virtual Machines (VMs) |
  |<#FFD700>     | Network Security Group |
  |<back:#E8F5E9>   | Availability Zones |
  
  <b>Endpoints Disponibles:</b>
  • GET http://[LoadBalancer-IP]:3000/
  • GET http://[LoadBalancer-IP]:3000/fibonacci/:n
  
  <b>Arquitectura:</b>
  Escalabilidad Horizontal con
  Load Balancing en Azure
endlegend

@enduml
